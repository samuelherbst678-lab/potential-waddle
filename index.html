<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Parlament Dashboard â€“ editierbar</title>

<style>
:root{
  --bg:#000;
  --card:#1c1c1e;
  --text:#fff;
  --muted:#9e9ea4;
  --row:#111;
  --input:#0f0f10;
  --inputBorder:rgba(255,255,255,.14);
  --btn:rgba(255,255,255,.10);
}

*{
  box-sizing:border-box;
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display",
  system-ui,Segoe UI,Roboto,Arial,sans-serif;
}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  display:flex;
  justify-content:center;
}

.container{
  width:390px;
  padding:16px;
}

.card{
  background:var(--card);
  border-radius:16px;
  padding:16px;
  margin-bottom:16px;
  border:1px solid rgba(255,255,255,.06);
}

.card h2{
  margin:0 0 12px;
  font-size:22px;
  font-weight:800;
}

.label{
  color:var(--muted);
  font-size:14px;
  margin:12px 0 6px;
}

.row{
  display:flex;
  align-items:center;
  gap:12px;
  padding:12px;
  border-radius:12px;
  background:var(--row);
  margin-bottom:10px;
  border:1px solid rgba(255,255,255,.06);
}

.avatar{
  width:36px;height:36px;
  border-radius:50%;
  background:#444;
}

.name{font-size:18px;font-weight:800;}
.sub{font-size:14px;color:var(--muted);}

/* Parlament */
.parliament{
  display:flex;
  justify-content:center;
  margin:10px 0 6px;
}

svg{display:block;overflow:visible;}

.legend{
  display:flex;
  justify-content:space-between;
  gap:8px;
  margin-top:10px;
}

.legend-item{
  flex:1;
  text-align:center;
}

.badge{
  padding:6px;
  border-radius:8px;
  font-weight:900;
}

.legend-item .num{
  margin-top:6px;
  font-size:18px;
  font-weight:900;
}

/* Editor */
.editorGrid{display:grid;gap:10px;}

.fieldRow{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}

.field{
  display:flex;
  flex-direction:column;
  gap:6px;
}

input,select{
  height:40px;
  padding:0 10px;
  border-radius:10px;
  border:1px solid var(--inputBorder);
  background:var(--input);
  color:#fff;
}

button{
  height:42px;
  border-radius:12px;
  background:var(--btn);
  color:#fff;
  border:1px solid rgba(255,255,255,.16);
  font-weight:900;
}
</style>
</head>

<body>
<div class="container">

<!-- =================== PARLAMENT =================== -->
<div class="card">
  <h2>Parlament</h2>
  <div class="parliament">
    <svg id="parliamentSvg"></svg>
  </div>
</div>

<!-- =================== EDITOR =================== -->
<div class="card">
  <h2>Editor</h2>

  <div class="field">
    <label>Parlament vertikal verschieben</label>
    <input id="editParliamentOffsetY" type="range" min="-120" max="120" step="1">
  </div>
</div>

</div>

<script>
/* =======================
   STATE
======================= */
const DEFAULT_STATE = {
  radius:140,
  thickness:72,
  parliamentOffsetY:0,
  orientation:0,
  parliamentSize:203,
  parties:[
    {name:"CSU",seats:85,color:"#000"},
    {name:"FW",seats:37,color:"#ff9500"},
    {name:"GrÃ¼ne",seats:32,color:"#0a8f08"},
    {name:"AfD",seats:32,color:"#7dd3ff"},
    {name:"SPD",seats:17,color:"#e00000"}
  ]
};

let state = structuredClone(DEFAULT_STATE);
const $ = id=>document.getElementById(id);

/* =======================
   ðŸ”’ FOKUS-SICHERES RENDER
======================= */
function safeRender(){
  const el = document.activeElement;
  const id = el?.id;
  const s = el?.selectionStart;
  const e = el?.selectionEnd;

  render();

  if(id){
    const r = document.getElementById(id);
    if(r){
      r.focus();
      if(r.setSelectionRange && s!=null){
        r.setSelectionRange(s,e);
      }
    }
  }
}

/* =======================
   SVG RENDER
======================= */
function polar(cx,cy,r,a){
  return {x:cx+r*Math.cos(a),y:cy+r*Math.sin(a)};
}

function render(){
  const svg = $("parliamentSvg");
  const r = state.radius;
  const t = state.thickness;
  const pad = 20;
  const size = 2*r+pad*2;
  const cx = r+pad;
  const cy = r+pad;

  svg.setAttribute("width",size);
  svg.setAttribute("height",size);
  svg.innerHTML="";

  const g = document.createElementNS("http://www.w3.org/2000/svg","g");
  g.setAttribute(
    "transform",
    `translate(0 ${state.parliamentOffsetY})`
  );

  let a = Math.PI;
  state.parties.forEach(p=>{
    const d = (p.seats/state.parliamentSize)*Math.PI;
    const p1 = polar(cx,cy,r,a);
    const p2 = polar(cx,cy,r,a-d);
    const p3 = polar(cx,cy,r-t,a-d);
    const p4 = polar(cx,cy,r-t,a);

    const path = document.createElementNS("http://www.w3.org/2000/svg","path");
    path.setAttribute("d",`
      M ${p1.x} ${p1.y}
      A ${r} ${r} 0 0 0 ${p2.x} ${p2.y}
      L ${p3.x} ${p3.y}
      A ${r-t} ${r-t} 0 0 1 ${p4.x} ${p4.y}
      Z
    `);
    path.setAttribute("fill",p.color);
    g.appendChild(path);
    a-=d;
  });

  svg.appendChild(g);
}

/* =======================
   EVENTS
======================= */
$("editParliamentOffsetY").addEventListener("input",e=>{
  state.parliamentOffsetY = Number(e.target.value);
  safeRender();
});

/* init */
safeRender();
</script>
</body>
</html>
