<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Parlament Dashboard â€“ editierbar</title>
<style>
:root{
  --bg:#000;
  --card:#1c1c1e;
  --text:#fff;
  --muted:#9e9ea4;
  --row:#111;
  --input:#0f0f10;
  --inputBorder:rgba(255,255,255,.14);
  --btn:rgba(255,255,255,.10);
}

*{ box-sizing:border-box; font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display",system-ui,Segoe UI,Roboto,Arial,sans-serif; }

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  display:flex;
  justify-content:center;
}

.container{
  width:390px;
  padding:16px;
}

.card{
  background:var(--card);
  border-radius:16px;
  padding:16px;
  margin-bottom:16px;
  border:1px solid rgba(255,255,255,.06);
}

.card h2{
  margin:0 0 12px 0;
  font-size:22px;
  letter-spacing:.2px;
  font-weight:800;
}

.label{
  color:var(--muted);
  font-size:14px;
  margin:12px 0 6px;
}

.row{
  display:flex;
  align-items:center;
  gap:12px;
  padding:12px;
  border-radius:12px;
  background:var(--row);
  margin-bottom:10px;
  border:1px solid rgba(255,255,255,.06);
}

.avatar{
  width:36px; height:36px; border-radius:50%;
  background:#444;
  border:1px solid rgba(255,255,255,.10);
}

.name{ font-size:18px; font-weight:800; }
.sub{ font-size:14px; color:var(--muted); font-weight:650; margin-top:2px; }

/* Parlament */
.parliament{ display:flex; justify-content:center; margin:10px 0 6px; }
svg{ overflow:visible; display:block; }

.legend{
  display:flex;
  justify-content:space-between;
  gap:8px;
  margin-top:10px;
}

.legend-item{
  display:flex;
  flex-direction:column;
  align-items:center;
  font-size:13px;
  min-width:0;
  flex:1 1 0;
}

.badge{
  width:100%;
  padding:6px 8px;
  border-radius:8px;
  color:#000;
  font-weight:900;
  text-align:center;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  border:1px solid rgba(255,255,255,.12);
}

.legend-item .num{
  margin-top:6px;
  font-size:18px;
  font-weight:900;
  color:rgba(255,255,255,.86);
}

/* Regierung/Opposition */
.bar-row{
  display:grid;
  grid-template-columns: 110px 1fr 50px;
  align-items:center;
  gap:10px;
  margin:12px 0;
}
.bar-row .left{
  font-size:18px;
  font-weight:900;
}
.bar{
  display:flex;
  gap:6px;
  justify-content:flex-start;
  align-items:center;
  min-height:30px;
}
.block{
  width:44px;
  height:28px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,.10);
}
.right{
  text-align:right;
  font-size:22px;
  font-weight:950;
  color:rgba(255,255,255,.86);
}

/* Editor */
.editorGrid{ display:grid; gap:10px; }

.fieldRow{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:10px;
}

.field{
  display:flex;
  flex-direction:column;
  gap:6px;
}

.field label{
  font-size:12px;
  color:rgba(255,255,255,.70);
  font-weight:800;
  letter-spacing:.2px;
}

input, select{
  height:40px;
  padding:0 10px;
  border-radius:10px;
  border:1px solid var(--inputBorder);
  background:var(--input);
  color:rgba(255,255,255,.92);
  outline:none;
  font-weight:700;
}

input[type="color"]{ padding:0; height:40px; }

.small{
  font-size:12px;
  color:rgba(255,255,255,.56);
  font-weight:650;
  line-height:1.35;
}

.btnRow{
  display:flex;
  gap:10px;
  margin-top:6px;
}

button{
  flex:1 1 0;
  height:42px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.16);
  background:var(--btn);
  color:rgba(255,255,255,.92);
  font-weight:950;
  cursor:pointer;
}

button:active{ transform:translateY(1px); }

hr.sep{
  border:none;
  border-top:1px solid rgba(255,255,255,.10);
  margin:12px 0;
}

.table{
  width:100%;
  border-collapse:separate;
  border-spacing:0 8px;
}

.table th{
  text-align:left;
  font-size:12px;
  color:rgba(255,255,255,.62);
  font-weight:900;
  padding:0 6px 4px;
}

.partyRow{
  background:#111;
  border:1px solid rgba(255,255,255,.08);
  border-radius:12px;
}

.partyRow td{
  padding:8px 6px;
  vertical-align:middle;
}

.partyRow input, .partyRow select{
  width:100%;
  height:36px;
  border-radius:10px;
}

.iconBtn{
  width:40px;
  height:36px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,.16);
  background:rgba(255,255,255,.08);
  color:rgba(255,255,255,.92);
  font-weight:950;
  cursor:pointer;
}

.orderBtns{
  display:flex;
  gap:6px;
  justify-content:flex-end;
}

.orderBtns .iconBtn{ width:36px; }

[draggable="true"]{ user-select:none; }
.dragOver{ outline:2px solid rgba(255,255,255,.22); }
</style>
</head>

<body>
<div class="container">

  <!-- =================== REGIERUNG (ANZEIGE) =================== -->
  <div class="card">
    <h2>Regierung</h2>

    <div class="label">Politiker</div>
    <div class="row">
      <div class="avatar" id="leader-avatar"></div>
      <div>
        <div class="name" id="leader-name"></div>
        <div class="sub" id="leader-title"></div>
      </div>
    </div>

    <div class="label">Regierungsparteien</div>
    <div id="gov-parties"></div>
  </div>

  <!-- =================== PARLAMENT (ANZEIGE) =================== -->
  <div class="card">
    <h2>Parlament</h2>

    <div class="parliament">
      <svg id="parliamentSvg"></svg>
    </div>

    <div class="label">Sitze im Parlament: <span id="seat-count"></span></div>
    <div class="legend" id="legend"></div>
  </div>

  <!-- =================== REG/OPP (ANZEIGE) =================== -->
  <div class="card">
    <h2>Regierung &amp; Opposition</h2>

    <div class="bar-row">
      <div class="left">Regierung</div>
      <div class="bar" id="gov-bar"></div>
      <div class="right" id="gov-count"></div>
    </div>

    <div class="bar-row">
      <div class="left">Opposition</div>
      <div class="bar" id="opp-bar"></div>
      <div class="right" id="opp-count"></div>
    </div>
  </div>

  <!-- =================== EDITOR =================== -->
  <div class="card">
    <h2>Editor</h2>

    <div class="editorGrid">
      <div class="label">Regierungschef</div>

      <div class="fieldRow">
        <div class="field">
          <label>Name</label>
          <input id="editLeaderName" type="text" />
        </div>
        <div class="field">
          <label>Amt</label>
          <input id="editLeaderTitle" type="text" />
        </div>
      </div>

      <div class="fieldRow">
        <div class="field">
          <label>Avatar-Farbe</label>
          <input id="editLeaderColor" type="color" />
        </div>
        <div class="field">
          <label>Parlament gesamt</label>
          <input id="editParliamentSize" type="number" />
        </div>
      </div>

      <div class="fieldRow">
        <div class="field">
          <label>Halbkreis: Dicke</label>
          <input id="editThickness" type="range" min="20" max="120" />
        </div>
        <div class="field">
          <label>Halbkreis: GrÃ¶ÃŸe</label>
          <input id="editRadius" type="range" min="90" max="190" />
        </div>
      </div>

      <div class="field">
        <label>Parlament vertikal verschieben</label>
        <input id="editParliamentOffsetY" type="range" min="-120" max="120" step="1" />
      </div>

      <div class="fieldRow">
        <div class="field">
          <label>Halbkreis: Richtung</label>
          <input id="editOrientation" type="range" min="0" max="3" step="1" />
        </div>
        <div class="field">
          <label>Richtung</label>
          <input id="orientationReadout" type="text" disabled />
        </div>
      </div>

      <hr class="sep" />

      <div class="label">Parteien</div>
      <table class="table">
        <tbody id="partyTableBody"></tbody>
      </table>
    </div>
  </div>

</div>

<script>
/* =======================
   STATE
======================= */
const DEFAULT_STATE = {
  leader:{ name:"Markus SÃ¶der", title:"MinisterprÃ¤sident", color:"#444444" },
  parliamentSize:203,
  radius:140,
  thickness:72,
  separator:3,
  orientation:0,
  parliamentOffsetY:0,
  parties:[
    { name:"GrÃ¼ne", seats:32, color:"#0a8f08", gov:false },
    { name:"SPD", seats:17, color:"#e00000", gov:false },
    { name:"CSU", seats:85, color:"#000000", gov:true },
    { name:"FW", seats:37, color:"#ff9500", gov:true },
    { name:"AfD", seats:32, color:"#7dd3ff", gov:false }
  ]
};

function loadState(){
  try{
    const raw = localStorage.getItem("parlament_dashboard_state");
    if(!raw) return structuredClone(DEFAULT_STATE);
    return { ...structuredClone(DEFAULT_STATE), ...JSON.parse(raw) };
  }catch{
    return structuredClone(DEFAULT_STATE);
  }
}

let state = loadState();
const $ = id=>document.getElementById(id);

/* ðŸ”’ Fokus-sicheres Render */
function safeRender(){
  const el = document.activeElement;
  const id = el?.id;
  const s = el?.selectionStart;
  const e = el?.selectionEnd;
  render();
  if(id){
    const r = document.getElementById(id);
    if(r){
      r.focus();
      if(r.setSelectionRange && s!=null) r.setSelectionRange(s,e);
    }
  }
}

/* =======================
   RENDER
======================= */
function render(){
  $("leader-name").textContent = state.leader.name;
  $("leader-title").textContent = state.leader.title;
  $("leader-avatar").style.background = state.leader.color;
  $("seat-count").textContent = state.parliamentSize;
  renderParliamentSvg();
  renderEditor();
}

function renderParliamentSvg(){
  const svg = $("parliamentSvg");
  const r = state.radius;
  const t = state.thickness;
  const pad = 18;
  const size = 2*r + pad*2;
  const cx = pad + r;
  const cy = pad + r;

  svg.setAttribute("width",size);
  svg.setAttribute("height",size);
  svg.innerHTML="";

  const g = document.createElementNS("http://www.w3.org/2000/svg","g");
  g.setAttribute(
    "transform",
    `translate(0 ${state.parliamentOffsetY}) rotate(${state.orientation*90} ${cx} ${cy})`
  );

  let a = Math.PI;
  state.parties.forEach(p=>{
    const d = (p.seats/state.parliamentSize)*Math.PI;
    const p1 = {x:cx+r*Math.cos(a), y:cy+r*Math.sin(a)};
    const p2 = {x:cx+r*Math.cos(a-d), y:cy+r*Math.sin(a-d)};
    const p3 = {x:cx+(r-t)*Math.cos(a-d), y:cy+(r-t)*Math.sin(a-d)};
    const p4 = {x:cx+(r-t)*Math.cos(a), y:cy+(r-t)*Math.sin(a)};
    const path = document.createElementNS("http://www.w3.org/2000/svg","path");
    path.setAttribute("d",`M ${p1.x} ${p1.y} A ${r} ${r} 0 0 0 ${p2.x} ${p2.y} L ${p3.x} ${p3.y} A ${r-t} ${r-t} 0 0 1 ${p4.x} ${p4.y} Z`);
    path.setAttribute("fill",p.color);
    g.appendChild(path);
    a -= d;
  });
  svg.appendChild(g);
}

function renderEditor(){
  $("editLeaderName").value = state.leader.name;
  $("editLeaderTitle").value = state.leader.title;
  $("editLeaderColor").value = state.leader.color;
  $("editParliamentSize").value = state.parliamentSize;
  $("editThickness").value = state.thickness;
  $("editRadius").value = state.radius;
  $("editOrientation").value = state.orientation;
  $("orientationReadout").value = ["unten","links","oben","rechts"][state.orientation];
  $("editParliamentOffsetY").value = state.parliamentOffsetY;
}

/* EVENTS */
["editLeaderName","editLeaderTitle","editLeaderColor","editParliamentSize","editThickness","editRadius","editOrientation","editParliamentOffsetY"]
.forEach(id=>{
  $(id).addEventListener("input",e=>{
    const k = id.replace("edit","");
    state[
      {LeaderName:"leader.name",LeaderTitle:"leader.title"}[k]||k.charAt(0).toLowerCase()+k.slice(1)
    ] = e.target.type==="number"||e.target.type==="range"?Number(e.target.value):e.target.value;
    safeRender();
  });
});

/* init */
safeRender();
</script>
</body>
</html>
